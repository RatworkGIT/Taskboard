@using Microsoft.Extensions.Localization
@using Taskboard.Components.Buttons
@using Taskboard.Components.Dialogs
@using Taskboard.Entities.Task
@using Taskboard.Models;
@using Taskboard.Models.DTO
@using Taskboard.Services.Format
@inject FormatService formatservice
@inject IDialogService DialogService
@inject IStringLocalizer<SharedResource> localizer

<MudCard Class="taskcard">
    <MudCardContent>
        <MudStack Row="false" Spacing="2">
            <MudText Align="Align.Left" Color="Color.Warning">#@CardTaskItem.Number</MudText>
            <MudLink Class="d-flex" Color="Color.Warning" Typo="Typo.h5" OnClick="@(() => OpenDialogAsync(CardTaskItem))" Style="font-weight: bold">@CardTaskItem.Title</MudLink>

            <MudSpacer/>
            <MudDivider/>
            <MudSpacer/>
            <MudText Align="Align.Left"> @CardTaskItem.Description </MudText>
            <MudStack Row="true" Justify="Justify.SpaceBetween">
                <MudText> @CardTaskItem.TaskStatus </MudText>
                <MudText Style="font-style: italic;"> @localizer["Created"] @sinceCreation </MudText>
            </MudStack>
        </MudStack>
    </MudCardContent>
</MudCard>

<style>
    .taskcard {
        background-color: #2b2d30;
        color: lightgray;
        margin: 0 2% 5% 2%;
    }
</style>

@code {
    [Parameter] 
    public ReadTaskDTO CardTaskItem { get; set; }

    public string sinceCreation = string.Empty;
    
    
    protected override void OnInitialized()
    {
        sinceCreation = formatservice.TimeSinceCreation(CardTaskItem.Created);
    }
    
    private Task OpenDialogAsync(ReadTaskDTO task)
    {
        var options = new DialogOptions { CloseOnEscapeKey = true, BackdropClick = false };
        var updateTask = new UpdateTaskDTO
        {
            Id = task.Id,
            Title = task.Title,
            Description = task.Description,
            TaskStatus = task.TaskStatus,
            Archived = task.Archived
        };
        var dialogParameters = new DialogParameters<UpdateDialog>
        {
            {x => x.CurrentTask, updateTask}
        };

        return DialogService.ShowAsync<UpdateDialog>(@localizer["Edit"], dialogParameters, options);
    }

    
}