@using Microsoft.Extensions.Localization
@using Taskboard.Entities.Task
@using Taskboard.Services.Task
@using Taskboard.Services.Update
@using TaskStatus = Taskboard.Entities.Task.TaskStatus
@inject TaskService taskservice
@inject UpdateService updateservice
@inject IStringLocalizer<SharedResource> localizer

<MudDialog>
    <TitleContent>
        @MudDialog.Title
    </TitleContent>
    <DialogContent>
        <MudTextField ShrinkLabel @bind-Value="task.Title" Label="@localizer["Title"]" Variant="Variant.Text"></MudTextField>
        <MudTextField ShrinkLabel @bind-Value="task.Description" Label="@localizer["Description"]" Variant="Variant.Text"></MudTextField>
        <MudSelect T="TaskStatus" @bind-Value="_taskStatus" Label="@localizer["TaskStatus"]">
            @foreach (TaskStatus item in Enum.GetValues(typeof(TaskStatus)))
            {
                <MudSelectItem Value="@item">@item</MudSelectItem>
            }
        </MudSelect>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">@localizer["Cancel"]</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">@localizer["Save"]</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] 
    private IMudDialogInstance MudDialog { get; set; }

    private TaskStatus _taskStatus = TaskStatus.ToDo;
    
    private TaskItemEntity task = new TaskItemEntity();

    private async void Submit()
    {
        await taskservice.CreateTaskAsync(task);
        MudDialog.Close(DialogResult.Ok(true));
        updateservice.CallRequestUpdate();
    }

    private void Cancel() => MudDialog.Cancel();
}